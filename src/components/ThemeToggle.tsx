import { IconButton, Menu, MenuItem, ListItemIcon, ListItemText, Tooltip } from '@mui/material'
import SettingsBrightnessIcon from '@mui/icons-material/SettingsBrightness'
import { useState } from 'react'
import { ThemeMode, useThemeStore } from '@/store/theme'
import { useTranslation } from 'react-i18next'
import { useTheme } from '@mui/material/styles'

const YodaIcon = ({ color }: { color: string }) => (
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" width="24" height="24">
    <path fill={color} d="M46.157,15.784c-0.873-0.46-1.939-0.363-2.717,0.25l-3.574,2.826c-0.971-3.966-7.01-11.871-11.728-11.871h-8.302	c-4.747,0-10.835,8.006-11.748,11.947l-3.56-2.814c-0.776-0.612-1.841-0.709-2.715-0.25c-0.871,0.458-1.394,1.391-1.33,2.379	c0.28,4.184,1.688,11.298,7.788,13.275c1.452,5.545,7.583,8.157,7.878,8.279l0.103,0.038c0.988,0.328,1.567,0.77,2.237,1.281	c1.161,0.886,2.477,1.891,5.498,1.891c3.021,0,4.336-1.004,5.497-1.891c0.67-0.512,1.249-0.954,2.238-1.282l0.103-0.038	c0.297-0.123,6.491-2.766,7.898-8.375c6.079-1.988,7.484-9.088,7.764-13.271C47.55,17.175,47.027,16.242,46.157,15.784z M7.959,27.62c-0.003,0.166-0.007,0.331-0.011,0.499C4.95,26.321,3.92,22.23,3.579,19.196l4.38,3.462V27.62z M30.746,35.813	c-0.073,0.016-0.146-0.026-0.17-0.097c-0.613-1.813-1.393-3.738-2.583-3.738c-1,0-2-0.003-4-0.003s-3,0.003-4,0.003	c-1.191,0-1.97,1.925-2.583,3.738c-0.024,0.071-0.097,0.112-0.17,0.097c-0.073-0.016-0.123-0.083-0.116-0.158	c0.074-0.785,0.16-1.646,0.259-2.144c0.083-0.412,0.179-0.823,0.283-1.238c0.123-0.487,0.224-2.308,6.327-2.298	c6.103-0.01,6.204,1.811,6.327,2.298c0.104,0.415,0.199,0.826,0.283,1.238c0.1,0.498,0.186,1.359,0.259,2.144	C30.869,35.73,30.819,35.797,30.746,35.813z M22,25.5c0-0.276,0.448-0.5,1-0.5s1,0.224,1,0.5c0,0.276-0.448,0.5-1,0.5	S22,25.777,22,25.5z M24,25.5c0-0.276,0.448-0.5,1-0.5s1,0.224,1,0.5c0,0.276-0.448,0.5-1,0.5S24,25.776,24,25.5z M35.435,22.592	l-0.002,0.001c-0.395,0.297-0.946,0.262-1.3-0.084c-1.723-1.681-4.144-1.681-7.367-1.091c0.107,0.127,0.225,0.246,0.315,0.383	c0.661,0.989,0.917,1.882,0.892,2.919c1.011,0.33,2.268,1.52,3.577,4.319c0.723,1.539,1.18,3.174,1.362,4.823	c0.008,0.074-0.04,0.142-0.112,0.159s-0.146-0.022-0.172-0.091c-0.573-1.53-1.287-2.978-2.14-4.301	c-1.055-1.611-2.381-2.994-3.961-3.878l-0.413-0.232l-0.027-0.545c-0.039-0.797-0.235-1.534-0.611-2.085	c-0.19-0.275-0.431-0.5-0.701-0.661c-0.239-0.15-0.524-0.232-0.72-0.243l-0.109,0.025l-0.053-0.018	c-0.194,0.021-0.456,0.096-0.682,0.237c-0.271,0.161-0.511,0.386-0.701,0.661c-0.377,0.551-0.569,1.289-0.61,2.085l-0.028,0.547	l-0.413,0.231c-1.579,0.884-2.905,2.267-3.96,3.878c-0.853,1.323-1.57,2.773-2.144,4.305c-0.026,0.07-0.1,0.109-0.172,0.092	c-0.072-0.017-0.12-0.086-0.112-0.159c0.18-1.651,0.636-3.29,1.361-4.831c1.311-2.806,3.285-4.061,3.566-4.224	c-0.027-1.037,0.243-2.023,0.904-3.012c0.122-0.185,0.273-0.351,0.424-0.516c-4.351-0.89-6.579,0.424-7.482,1.234	c-0.334,0.299-0.826,0.341-1.204,0.1l-0.034-0.021c-0.254-0.162-0.418-0.433-0.444-0.733c-0.025-0.3,0.091-0.595,0.314-0.797	c1.438-1.303,4.91-3.28,11.571-1.131c4.01-0.899,8.456-1.818,11.483,1.14c0.208,0.204,0.318,0.488,0.299,0.779	C35.812,22.148,35.668,22.417,35.435,22.592z M32,23.5c0,0.828-0.672,1.5-1.5,1.5S29,24.328,29,23.5s0.672-1.5,1.5-1.5	S32,22.672,32,23.5z M16,23.5c0-0.828,0.672-1.5,1.5-1.5s1.5,0.672,1.5,1.5S18.328,25,17.5,25S16,24.328,16,23.5z M40.021,28.031	c-0.002-0.091-0.004-0.181-0.006-0.272v-5.193l4.375-3.458C44.049,22.144,43.02,26.233,40.021,28.031z"/>
  </svg>
)

const VaderIcon = ({ color }: { color: string }) => (
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24">
    <path fill={color} d="M 11 2.0195312 C 7.345 2.1995313 4.3955937 4.3572813 3.9335938 7.9882812 C 4.6795938 7.4132812 5.7085469 7.0136719 7.1855469 7.0136719 C 9.1075469 7.0136719 10.081 7.2507656 11 8.1347656 L 11 2.0195312 z M 12.001953 2.0195312 L 12.001953 8.1367188 C 12.922953 7.2507188 13.897219 7.0136719 15.824219 7.0136719 C 17.150219 7.0136719 18.211453 7.3381875 19.064453 7.9921875 C 18.603536 4.3598432 15.656039 2.2012128 12.001953 2.0195312 z M 7.1855469 8.0136719 C 5.2735469 8.0136719 4.1458281 8.7139219 3.2988281 10.419922 L 1.0527344 16.068359 C 0.68573438 17.126359 2.2049531 18.735266 3.3769531 19.697266 C 4.3669531 20.510266 5.5963281 21.060719 6.4863281 21.386719 L 5.0605469 18.736328 C 4.9295469 18.493328 5.0206719 18.189594 5.2636719 18.058594 C 5.5096719 17.929594 5.8104062 18.019719 5.9414062 18.261719 L 7.4726562 21.107422 L 11.078125 15.238281 C 11.169125 15.090281 11.329906 15 11.503906 15 C 11.677906 15 11.838688 15.091281 11.929688 15.238281 L 15.529297 21.105469 L 17.056641 18.263672 C 17.186641 18.019672 17.490422 17.929594 17.732422 18.058594 C 17.975422 18.189594 18.0685 18.493328 17.9375 18.736328 L 16.515625 21.384766 C 17.404625 21.058766 18.633094 20.509266 19.621094 19.697266 C 20.793094 18.736266 22.310359 17.126359 21.943359 16.068359 L 19.648438 10.292969 C 18.853437 8.7239688 17.666266 8.0136719 15.822266 8.0136719 C 13.455266 8.0136719 12.936297 8.3739219 11.904297 9.7949219 C 11.896297 9.8049219 11.884953 9.8083594 11.876953 9.8183594 C 11.858953 9.8393594 11.839359 9.8589531 11.818359 9.8769531 C 11.808359 9.8849531 11.804922 9.8972969 11.794922 9.9042969 C 11.788922 9.9082969 11.780438 9.9081094 11.773438 9.9121094 C 11.757437 9.9231094 11.741609 9.9314531 11.724609 9.9394531 C 11.700609 9.9514531 11.675391 9.96075 11.650391 9.96875 C 11.631391 9.97475 11.614703 9.9823281 11.595703 9.9863281 C 11.576703 9.9903281 11.556109 9.9911875 11.537109 9.9921875 C 11.524109 9.9931875 11.514 10 11.5 10 C 11.486 10 11.475891 9.9931875 11.462891 9.9921875 C 11.443891 9.9911875 11.423297 9.9903281 11.404297 9.9863281 C 11.385297 9.9823281 11.368609 9.97475 11.349609 9.96875 C 11.323609 9.96075 11.298391 9.9514531 11.275391 9.9394531 C 11.258391 9.9304531 11.242562 9.9221094 11.226562 9.9121094 C 11.220562 9.9081094 11.212078 9.9082969 11.205078 9.9042969 C 11.195078 9.8962969 11.190641 9.8849531 11.181641 9.8769531 C 11.160641 9.8589531 11.141047 9.8393594 11.123047 9.8183594 C 11.115047 9.8083594 11.102703 9.8049219 11.095703 9.7949219 C 10.065703 8.3739219 9.5455469 8.0136719 7.1855469 8.0136719 z M 8.0117188 10.308594 C 9.1617188 10.308594 9.6982656 11.076969 9.9472656 11.792969 C 10.152266 12.379969 9.7357187 13 9.1367188 13 L 6.8886719 13 C 6.2896719 13 5.8721719 12.379969 6.0761719 11.792969 C 6.3251719 11.076969 6.8617188 10.308594 8.0117188 10.308594 z M 15.011719 10.308594 C 16.161719 10.308594 16.698266 11.076969 16.947266 11.792969 C 17.152266 12.379969 16.735719 13 16.136719 13 L 13.888672 13 C 13.289672 13 12.872172 12.379969 13.076172 11.792969 C 13.325172 11.076969 13.861719 10.308594 15.011719 10.308594 z M 11.503906 16.455078 L 8.1875 21.853516 C 9.6795 22.035516 13.323453 22.037516 14.814453 21.853516 L 11.503906 16.455078 z"/>
  </svg>
)

export function ThemeToggle() {
  const { t } = useTranslation()
  const mode = useThemeStore((s) => s.mode)
  const setMode = useThemeStore((s) => s.setMode)
  const [anchor, setAnchor] = useState<null | HTMLElement>(null)
  const theme = useTheme()
  const iconColor = theme.palette.mode === 'dark' ? '#000' : '#fff'

  const icon =
    mode === 'dark'
      ? <VaderIcon color={iconColor} />
      : mode === 'light'
        ? <YodaIcon color={iconColor} />
        : <SettingsBrightnessIcon htmlColor={iconColor} />

  const choose = (m: ThemeMode) => () => {
    setMode(m)
    setAnchor(null)
  }

  return (
    <>
      <Tooltip title={t('theme.title', { mode })}>
        <IconButton color="inherit" onClick={(e) => setAnchor(e.currentTarget)} aria-label="theme" sx={{ color: iconColor }}>
          {icon}
        </IconButton>
      </Tooltip>
      <Menu anchorEl={anchor} open={!!anchor} onClose={() => setAnchor(null)}>
        <MenuItem onClick={choose('light')}>
          <ListItemIcon><YodaIcon color='#000'/></ListItemIcon>
          <ListItemText>{t('theme.light')}</ListItemText>
        </MenuItem>
        <MenuItem onClick={choose('dark')}>
          <ListItemIcon><VaderIcon color='#000' /></ListItemIcon>
          <ListItemText>{t('theme.dark')}</ListItemText>
        </MenuItem>
        {/* <MenuItem onClick={choose('system')}>
          <ListItemIcon><SettingsBrightnessIcon fontSize="small" /></ListItemIcon>
          <ListItemText>{t('theme.system')}</ListItemText>
        </MenuItem> */}
      </Menu>
    </>
  )
}
